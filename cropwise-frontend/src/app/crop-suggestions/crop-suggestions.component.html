<app-navbar></app-navbar>

<div class="suggestions-container">
    <h2>Crop Suggestions</h2>
    
    <div class="farm-selection-section" *ngIf="farms.length > 0">
        <h3>Select a Farm</h3>
        <div class="farms-grid">
            <div *ngFor="let farm of farms" class="farm-card" [class.selected]="selectedFarm?.id === farm.id" (click)="selectFarm(farm)">
                <h4>{{ farm.farmName }}</h4>
                <div class="farm-details">
                    <p><strong>Size:</strong> {{ farm.farmSize }} acres</p>
                    <p><strong>Location:</strong> {{ farm.location }}</p>
                    <p><strong>Soil Type:</strong> {{ farm.soilType }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div *ngIf="farms.length === 0 && !loading" class="no-farms-message">
        <p>No farms found. Please add farm details first.</p>
        <button (click)="navigateToFarmForm()" class="secondary-btn">Add Farm Details</button>
    </div>
    
    <div *ngIf="selectedFarm && !loading" class="suggestion-actions">
        <button (click)="getSuggestions()" class="get-suggestions-btn" [disabled]="loading">
            {{ hasSavedSuggestions ? 'Generate New Suggestions' : 'Get Crop Suggestions' }}
        </button>
        <p *ngIf="hasSavedSuggestions" class="last-updated">
            Last updated: {{ lastUpdated | date:'medium' }}
        </p>
    </div>
    
    <div *ngIf="error" class="error-message">
      {{ error }}
    </div>
    
    <div *ngIf="loading" class="loading">
      <p>Analyzing your farm data and local weather conditions...</p>
      <div class="spinner"></div>
    </div>
    
    <div *ngIf="weatherData && !loading" class="weather-data">
      <h3>Current Weather Conditions</h3>
      <div class="weather-grid">
        <div class="weather-item">
          <span class="label">Temperature:</span>
          <span class="value">{{ weatherData.temperature }}Â°C</span>
        </div>
        <div class="weather-item">
          <span class="label">Rainfall:</span>
          <span class="value">{{ weatherData.rainfall }} mm</span>
        </div>
        <div class="weather-item">
          <span class="label">Humidity:</span>
          <span class="value">{{ weatherData.humidity }}%</span>
        </div>
        <div class="weather-item">
          <span class="label">Season:</span>
          <span class="value">{{ weatherData.season }}</span>
        </div>
        <div *ngIf="weatherData.forecast" class="weather-item">
          <span class="label">Forecast:</span>
          <span class="value">{{ weatherData.forecast }}</span>
        </div>
      </div>
    </div>
    
    <div *ngIf="suggestions.length > 0 && !loading" class="suggestions-list">
      <h3>Recommended Crops</h3>
      
      <div *ngFor="let suggestion of suggestions" class="suggestion-card">
        <div class="suggestion-header">
          <h4>{{ suggestion.cropName }}</h4>
          <div class="confidence" [style.background-color]="getConfidenceColor(suggestion.confidence)">
            {{ suggestion.confidence }}% Confidence
          </div>
        </div>
        
        <div class="suggestion-details">
          <div class="detail-item">
            <span class="label">Reasons for Selection:</span>
            <ul>
              <li *ngFor="let reason of suggestion.reasonsForSelection">{{ reason }}</li>
            </ul>
          </div>
          
          <div class="detail-item">
            <span class="label">Planting Time:</span>
            <span class="value">{{ suggestion.plantingTime }}</span>
          </div>
          
          <div class="detail-item">
            <span class="label">Harvest Time:</span>
            <span class="value">{{ suggestion.harvestTime }}</span>
          </div>
          
          <div class="detail-item">
            <span class="label">Time to Harvest:</span>
            <span class="value">{{ suggestion.timeToHarvest }}</span>
          </div>
          
          <div class="detail-item">
            <span class="label">Expected Yield:</span>
            <span class="value">{{ suggestion.expectedYield }}</span>
          </div>
          
          <div class="detail-item">
            <span class="label">Capital Required:</span>
            <span class="value">{{ suggestion.capitalRequired }}</span>
          </div>
          
          <div class="detail-item">
            <span class="label">Water Requirements:</span>
            <span class="value">{{ suggestion.waterRequirements }}</span>
          </div>
          
          <div class="detail-item">
            <span class="label">Recommended Fertilizers:</span>
            <ul>
              <li *ngFor="let fertilizer of suggestion.fertilizers">{{ fertilizer }}</li>
            </ul>
          </div>
          
          <div class="detail-item">
            <span class="label">Pest Management:</span>
            <ul>
              <li *ngFor="let pest of suggestion.pestManagement">{{ pest }}</li>
            </ul>
          </div>
          
          <div *ngIf="suggestion.additionalNotes" class="detail-item notes">
            <span class="label">Additional Notes:</span>
            <p>{{ suggestion.additionalNotes }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
